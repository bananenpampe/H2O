Similarily to schnetpack, lets split a NN-potential into several components


coordinates -> feats -> atomic_model -> aggregation

if the feats are precomputed, feats could be a "pass-through" block

feats -> atomic_model -> aggregation

A learnable feats block could also take in precomputed feats and work with them (ie alchemical.)

The atomic model could do mixing, MP operations ... whatever.
Keep it simple and just have a single sub_model, or one sub_model per atomic species.
(one NN per arbitrary group ?)

a sub_model is either invariant or equivariant, and returns invariant, or equivariant atomic predictions
(can infer from the metadata, what operations to do?)

Finally, the aggregation layer deals with different aggregation tasks.
There should be a "pass-thorugh" aggregation that does nothing for atom wise predictions
There should be a "mean" and "sum" global aggregation.
There should  be a group-wise aggregation that calculates predictions for groups "mean", "sum" wise.

There should be a user-defined / "meta"-data aggregator.
(ie calculate the dipole moment from predicted charges, which would require the positions as metadata aswell)
#-> this is effectively a weighted mean/sum aggregator as each charge is weighted using metadata (positions)

An aggregator could also handle global properties like electron density from local predictions ?

